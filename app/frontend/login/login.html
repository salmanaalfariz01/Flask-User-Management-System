<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
    <div class="container vh-100 d-flex justify-content-center align-items-center">
        <div class="card shadow-sm p-4" style="width: 100%; max-width: 400px;">
            <h3 class="text-center mb-4">Login</h3>

            <!-- Error Message -->
            {% if request.args.get('error') == 'incorrect-password' %}
                <div class="alert alert-danger" role="alert">
                    Password salah. Silakan coba lagi.
                </div>
            {% elif request.args.get('error') == 'user-not-found' %}
                <div class="alert alert-danger" role="alert">
                    Pengguna tidak ditemukan. Silakan daftar.
                </div>
            {% endif %}

            <!-- Login Form -->
            <form method="POST" action="/login">
                <div class="mb-3">
                    <label for="username" class="form-label">Username</label>
                    <input type="text" id="username" name="username" class="form-control" placeholder="Masukkan username" required>
                </div>
                <div class="mb-3">
                    <label for="password" class="form-label">Password</label>
                    <input type="password" id="password" name="password" class="form-control" placeholder="Masukkan password" required autocomplete="off">
                </div>
                <div class="d-grid">
                    <button type="submit" class="btn btn-primary">Login</button>
                </div>
            </form>

            <!-- Link to Register -->
            <p class="mt-3 text-center">
                Belum punya akun? <a href="/register" class="text-decoration-none">Daftar di sini</a>
            </p>
        </div>
    </div>

    <!-- Alert untuk Kedaluwarsa Sesi -->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Ambil waktu kedaluwarsa dari cookie
            const sessionExpiry = document.cookie
                .split("; ")
                .find((row) => row.startsWith("session_expiry="))
                ?.split("=")[1];

            if (sessionExpiry) {
                const expiryDate = new Date(sessionExpiry);
                const now = new Date();

                const timeRemaining = expiryDate - now;

                if (timeRemaining > 0) {
                    // Alert 1 menit sebelum sesi habis
                    setTimeout(() => {
                        alert("Sesi Anda akan berakhir dalam 1 menit. Silakan simpan pekerjaan Anda.");
                    }, timeRemaining - 60000);

                    // Redirect setelah sesi habis
                    setTimeout(() => {
                        alert("Sesi Anda telah berakhir. Silakan login kembali.");
                        window.location.href = "/login";
                    }, timeRemaining);
                }
            }
        });
    </script>
</body>

</html>
