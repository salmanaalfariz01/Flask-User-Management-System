<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Register</title>
    <link rel="stylesheet" href="{{ url_for('register.static', filename='register.css') }}">
</head>
<body>
    <h1>Register</h1>
    <form action="{{ url_for('register.show') }}" method="POST">
        <input type="text" name="username" placeholder="Username" required>
        <input type="email" name="email" placeholder="Email" required>
        <input type="number" name="phone" placeholder="Phone" required>
        <input type="password" name="password" placeholder="Password" required>
        <input type="password" name="confirm-password" placeholder="Confirm Password" required>

        <!-- Dropdown Divisions -->
        <label for="division">Division:</label>
        <select id="division" name="division_id" required>
            <option value="">Select Division</option>
            {% for division in divisions %}
            <option value="{{ division.id }}">{{ division.name }}</option>
            {% endfor %}
        </select>
    
        <label for="position">Position:</label>
        <select id="position" name="position_id" required>
            <option value="">Select Position</option>
        </select>

        <button type="submit">Register</button>
    </form>

    {% if request.args.get('error') %}
    <p class="error">{{ request.args.get('error') }}</p>
    {% endif %}
    {% if request.args.get('success') %}
    <p class="success">{{ request.args.get('success') }}</p>
    {% endif %}

    <!-- Link for users who already have an account -->
    <p>Already have an account? <a href="{{ url_for('login.show') }}">Login here</a></p>

</body>
<script>
    // JavaScript to load positions based on division
    document.getElementById('division').addEventListener('change', function () {
        const divisionId = this.value;
        const positionDropdown = document.getElementById('position');

        // Clear previous position options
        positionDropdown.innerHTML = '<option value="">Select Position</option>';

        if (divisionId) {
            // Send request to server to get positions
            fetch(`/positions/${divisionId}`)
                .then(response => response.json())
                .then(data => {
                    // Add position options received from the server
                    data.positions.forEach(position => {
                        const option = document.createElement('option');
                        option.value = position.id;
                        option.textContent = position.name;
                        positionDropdown.appendChild(option);
                    });
                })
                .catch(error => console.error('Error fetching positions:', error));
        }
    });
</script>
</html>
